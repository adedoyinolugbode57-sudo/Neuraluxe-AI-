FROM python:3.10-slim
WORKDIR /app

# Install requirements
COPY requirements.txt .
RUN pip install --upgrade pip
RUN pip install -r requirements.txt

# Copy app files
COPY . .

# Expose port
EXPOSE 10000

# Environment variables
ENV FLASK_ENV=production
ENV PORT=10000
ENV OPENAI_ENABLED=false
ENV CACHE_TYPE=simple
ENV LOG_LEVEL=info
ENV ENABLE_ENV_CHECK=true
ENV DATABASE_URL=postgresql://postgres:password@db:5432/neuraluxe
ENV REDIS_URL=redis://redis:6379/0

# Start app
CMD ["gunicorn", "main:app", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "-b", "0.0.0.0:10000", "--timeout", "120"]